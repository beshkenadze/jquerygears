<html>
<head>
<title>jQueryGears GeoLocation Demo</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<body>
<div id="message_place"></div>
<div id="map_canvas" style="width: 500px; height: 400px"></div>
<script type="text/javascript" src="http://www.google.com/jsapi?key=ABQIAAAAqST4dCrRr3VUA2hQx-BamhRpHN8VuFduCFff_Y7yM76pWR-mlhQvW8f-HakRAJQlkI9aarcvW0nS1A"></script>
<script>
// Load jQuery
google.load("jquery", "1");
google.load("maps", "2");
window.onload = function(){
var geo = $.gears('beta.geolocation',{siteName:'Супер-сайт',extraMessage:'Если вы хотите, что бы наш сайт работал с вами, довертесь нам ;)'});
console.log(geo);
	if($.gears.userPermission){
		if(geo){
			// If Gears install
		    geo.getCurrentPosition(function(position){
		        var map;
			    var geocoder;
			    var address;
			      map = new GMap2(document.getElementById("map_canvas"));
			      map.setCenter(new GLatLng(position.latitude,position.longitude), 10);
			      map.addControl(new GLargeMapControl);
			      //GEvent.addListener(map, "click", getAddress);
			      point = new GLatLng(position.latitude,position.longitude);
		          marker = new GMarker(point);
		          map.addOverlay(marker);
			      geocoder = new GClientGeocoder();
			      
			      var address = position.gearsAddress.city + ', '
                  + position.gearsAddress.region + ', '
                  + position.gearsAddress.country + ' ('
                  + position.latitude + ', '
                  + position.longitude + ')';
			    
		        //latitude=59 longitude=30 accuracy=140000
		    	console.log(position);
		       $('#message_place').html('Вы нахожитесь: ' + address);
		    }, function(positionError){
		       $('#message_place').html('Attempt to get location failed: ' + positionError.message);
		    },{ enableHighAccuracy: true,gearsRequestAddress: true });
		   }else{
			// Else Gears NOT install
		      $.gears.install({element:'#message_place'});   
		   }
	}
}
</script>
<script src="jquery.gears.js"></script>
</body>
</html>
